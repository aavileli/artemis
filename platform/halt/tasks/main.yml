###################################################################################################

- name: import | distribution

  when: distribution_release_is_trusty
     or distribution_release_is_utopic

  include_vars: '{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version | lower }}{{ yaml_file_extension }}'

  tags:
    - artemis
    - platform
    - halt

###################################################################################################

- name: import | overrides

  when: overrides_verified

  include_vars: '{{ overrides_path }}'

  tags:
    - artemis
    - platform
    - halt

###################################################################################################

- name: flush

  meta: flush_handlers

  tags:
    - artemis
    - platform
    - halt

###################################################################################################

- name: execute

  become: true

  shell: '{{ halt_command }}'

  tags:
    - artemis
    - platform
    - halt

###################################################################################################

- name: wait

  become: false

  local_action: wait_for host={{ halt_host }}
                         port={{ halt_port }}
                      timeout={{ halt_wait }}
                        state=stopped

  tags:
    - artemis
    - platform
    - halt

###################################################################################################
